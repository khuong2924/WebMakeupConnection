<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Makeup Artist Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.2.3/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tippy.js/6.3.1/tippy.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tippy.js/6.3.1/tippy.min.js"></script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var userId = /*[[${session.user.getId()}]]*/ 'default_user_id';
        /*]]>*/
    </script>


</head>
<body class="bg-gray-50 scroll-smooth">
    <!-- Navbar -->

    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-center space-x-12 py-4">
                <a href="/home">
                    <img src="img/home.png" alt="Home" class="h-6 w-6 transition-transform duration-200 transform hover:scale-110">
                </a>
                <a href="/profile">
                    <img src="/img/user.png" alt="Profile" class="h-6 w-6 transition-transform duration-200 transform hover:scale-110">
                </a>
                <img src="/img/alarm.png" alt="Notify" class="h-6 w-6 transition-transform duration-200 transform hover:scale-110">
                <a href="/chatBox">
                    <img src="/img/message.png" alt="Notify" class="h-6 w-6 transition-transform duration-200 transform hover:scale-110">
                </a>
            </div>
        </div>
    </nav>




    <div class="max-w-4xl mx-auto p-4 mt-24">
        <div class="relative">
            <div id="coverPhotoContainer" class="h-64 md:h-80 rounded-lg overflow-hidden shadow-lg transition-transform transform hover:scale-105 duration-300">
                <img id="coverPhotoDisplay" src="https://images.unsplash.com/photo-1516975080664-ed2fc6a32937" alt="Cover Photo" class="w-full h-full object-cover">
            </div>
            <div class="absolute -bottom-16 left-4 md:left-8">
                <img id="profilePictureDisplay" src="https://images.unsplash.com/photo-1487412720507-e7ab37603c6f" alt="Profile Picture" class="w-32 h-32 md:w-40 md:h-40 rounded-full border-4 border-white shadow-lg object-cover transition-transform transform hover:scale-110">
            </div>
        </div>

        <div class="mt-20 md:mt-24">
            <div class="flex flex-col md:flex-row md:items-center justify-between">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Sarah Anderson</h1>
                    <p class="text-gray-600 mt-1">@makeupbysarah</p>
                    <p class="text-gray-700 mt-2">‚ú® Professional Makeup Artist | üìç New York</p>
                </div>
                <button onclick="document.getElementById('editModal').classList.remove('hidden')" class="mt-4 md:mt-0 bg-purple-600 px-6 py-2 rounded-full hover:bg-purple-700 transition ease-in-out duration-300">
                    <img src="../img/edtProfile.png" alt="Ch·ªânh s·ª≠a trang c√° nh√¢n" class="h-6 transition-transform duration-300 hover:scale-110">
                </button>                               
                <div id="editModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto h-full w-full z-50" onclick="checkClickOutside(event)">
                    <div class="relative top-5 mx-auto p-5 w-full max-w-2xl" onclick="event.stopPropagation()">
                        <div class="bg-white rounded-2xl shadow-2xl">
                            <div class="p-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h2 class="text-2xl font-bold text-gray-800">Ch·ªânh s·ª≠a trang c√° nh√¢n</h2>
                                    <button onclick="document.getElementById('editModal').classList.add('hidden')" class="text-gray-600 hover:text-gray-800 transition-colors">
                                        <i class="fas fa-times text-xl"></i>
                                    </button>
                                </div>
            
                                <form id="profileForm" enctype="multipart/form-data" class="space-y-6" action="/profile/update" method="post">
                                    <div class="flex flex-col md:flex-row gap-6">
                                        <div class="w-full md:w-1/2 flex flex-col items-center">
                                            <div class="relative w-32 h-32 mb-2">
                                                <img id="avatarPreview" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330" alt="Current avatar" class="w-full h-full object-cover rounded-full">
                                                <label class="absolute bottom-0 right-0 bg-purple-500 p-2 rounded-full cursor-pointer hover:bg-purple-600 transition-colors">
                                                    <img src="../img/addImage.png" class="h-6 w-6">
                                                    <input type="file" class="hidden"  id="portfolioPhoto" name="portfolioPhoto" placeholder="Portfolio Photo URL" value="${profile.coverPhoto}" accept="image/*" onchange="previewTempImage(event, 'avatarPreview')">
                                                </label>
                                            </div>
                                            <span class="text-sm text-gray-500 text-center">·∫¢nh ƒë·∫°i di·ªán</span>
                                        </div>
                                        <div class="w-full md:w-1/2 flex flex-col">
                                            <div class="relative h-32 rounded-lg overflow-hidden mb-2">
                                                <img id="coverPhotoPreview" src="https://images.unsplash.com/photo-1562887189-e5d078343de4" alt="Cover photo" class="w-full h-full object-cover">
                                                <label class="absolute bottom-2 right-2 bg-purple-500 p-2 rounded-full cursor-pointer hover:bg-purple-600 transition-colors">
                                                    <img src="../img/addImage.png" class="h-6 w-6">
                                                    <input type="file" class="hidden" id="coverPhoto" name="coverPhoto"  placeholder="Cover Photo URL" value="${profile.portfolioPhoto}" accept="image/*" onchange="previewTempImage(event, 'coverPhotoPreview')">
                                                </label>
                                            </div>
                                            <span class="text-sm text-gray-500 text-center">·∫¢nh b√¨a</span>
                                        </div>
                                    </div>                                   
            
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">H·ªç v√† t√™n</label>
                                            <input type="text" id="fullName" name="fullName" value="${profile.fullName}" placeholder="Full Name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required >
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                                            <div class="relative">
                                                <span class="absolute left-4 top-2 text-gray-500">@</span>
                                                <select name="gender" id="gender" class="w-full px-4 py-2 pl-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                                    <option value="Male">Male</option>
                                                    <option value="Female">Female</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Ng√†y sinh</label>
                                            <input type="date" id="birthDate" name="birthDate" value="${profile.birthDate}" placeholder="Birth Date" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">ƒê·ªãa ch·ªâ</label>
                                            <input type="text" id="address" name="address" value="${profile.address}" placeholder="Address" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        </div>
                                    </div>
            
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ti·ªÉu s·ª≠</label>
                                        <textarea type="text" id="bio" name="bio" value="${profile.bio}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent h-32 resize-none">Professional makeup artist with 5+ years of experience in fashion and bridal makeup. Passionate about creating unique looks that enhance natural beauty.</textarea>
                                    </div>
            
                                    <div class="flex justify-end space-x-4">
                                        <button id="cancelButton" type="button" onclick="document.getElementById('editModal').classList.add('hidden')" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">H·ªßy</button>
                                        <button id="saveButton" type="button" onclick="saveChanges()" class="px-6 py-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-lg hover:from-pink-600 hover:to-purple-600 transition-all duration-300">L∆∞u</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Modal x√°c nh·∫≠n -->
<!--                <div id="confirmLeaveModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center">-->
<!--                    <div class="bg-white rounded-2xl p-6 shadow-2xl w-full max-w-md">-->
<!--                        <h3 class="text-xl font-semibold mb-4">X√°c nh·∫≠n r·ªùi kh·ªèi?</h3>-->
<!--                        <p class="mb-6">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën r·ªùi kh·ªèi m√† kh√¥ng l∆∞u c√°c thay ƒë·ªïi?</p>-->
<!--                        <div class="flex justify-end space-x-4">-->
<!--                            <button onclick="closeConfirmModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">H·ªßy</button>-->
<!--                            <button onclick="closeEditModal()" class="px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-lg hover:from-pink-600 hover:to-purple-600 transition-all duration-300">X√°c nh·∫≠n</button>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
            </div>

            <!-- Posts Section -->
            <div class="mt-8">
                <h2 class="text-xl font-semibold mb-4">B√†i ƒëƒÉng</h2>
                <div class="space-y-6">
                    <!-- Post 1 -->
                    <div class="bg-white p-4 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-lg">Bridal Makeup for Emma</h3>
                            <!-- Edit Button Dropdown with Alpine.js for interactivity -->
                            <div x-data="{ open: false }" class="relative">
                                <button @click="open = !open" class="text-gray-500 hover:text-purple-600 focus:outline-none transition-colors duration-200">
                                    ‚ãÆ
                                </button>
                                <div x-show="open" @click.outside="open = false" class="absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-xl origin-top-right scale-95 transition-transform transform ease-in-out duration-200 z-10">
                                    <a href="#" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-purple-100 hover:text-purple-700 transition-all duration-200 rounded-t-lg">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 mr-2" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12.485 3.879l7.121 7.121-1.414 1.415-7.12-7.122-2.12 2.121L3.88 9.757l2.121-2.121 7.121-7.12zM3.707 17.293l7.121-7.122 1.415 1.414-7.122 7.121H3v-1.414z" />
                                        </svg>
                                        Ch·ªânh s·ª≠a
                                    </a>
                                    <a href="#" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-red-100 hover:text-red-700 transition-all duration-200">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 mr-2" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M3 6h18M9 6V4h6v2M5 6v14h14V6H5zm4 4h2v6H9v-6zm4 0h2v6h-2v-6z" />
                                        </svg>
                                        X√≥a
                                    </a>
                                    <a href="#" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-yellow-100 hover:text-yellow-700 transition-all duration-200 rounded-b-lg">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 mr-2" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                        </svg>
                                        ƒê√°nh d·∫•u ∆∞u ti√™n
                                    </a>
                                </div>
                            </div>                            
                        </div>
                        <p class="text-gray-700 mb-4">Had an amazing time creating this bridal look for Emma's wedding! Subtle glam with long-lasting wear.</p>
                        <div class="mb-4">
                            <img src="https://images.unsplash.com/photo-1522337360788-8b13dee7a37e" alt="Bridal Makeup" class="w-full h-64 object-cover rounded-lg shadow-md">
                        </div>
                    </div>
                    
                    <!-- Post 2 -->
                    <div class="bg-white p-4 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-lg">Editorial Look for Vogue</h3>
                            <div x-data="{ open: false }" class="relative">
                                <button @click="open = !open" class="text-gray-500 hover:text-gray-700 focus:outline-none">‚ãÆ</button>
                                <div x-show="open" @click.outside="open = false" class="absolute right-0 mt-2 w-48 bg-white border rounded shadow-lg origin-top-right scale-95 transition-transform transform ease-in-out duration-200">
                                    <a href="#" class="flex items-center px-4 py-2 text-sm hover:bg-gray-100">Edit</a>
                                    <a href="#" class="flex items-center px-4 py-2 text-sm hover:bg-gray-100">Delete</a>
                                    <a href="#" class="flex items-center px-4 py-2 text-sm hover:bg-gray-100">Mark as Priority</a>
                                </div>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-4">Collaborated with Vogue for a stunning editorial photoshoot featuring dramatic eye makeup.</p>
                        <div class="mb-4">
                            <img src="https://images.unsplash.com/photo-1512496015851-a90fb38ba796" alt="Editorial Makeup" class="w-full h-64 object-cover rounded-lg shadow-md">
                        </div>
                    </div>

                    <!-- Post 3 -->
                    <div class="bg-white p-4 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-lg">Runway Glam for Fashion Week</h3>
                            <div x-data="{ open: false }" class="relative">
                                <button @click="open = !open" class="text-gray-500 hover:text-gray-700 focus:outline-none">‚ãÆ</button>
                                <div x-show="open" @click.outside="open = false" class="absolute right-0 mt-2 w-48 bg-white border rounded shadow-lg origin-top-right scale-95 transition-transform transform ease-in-out duration-200">
                                    <a href="#" class="flex items-center px-4 py-2 text-sm hover:bg-gray-100">Edit</a>
                                    <a href="#" class="flex items-center px-4 py-2 text-sm hover:bg-gray-100">Delete</a>
                                    <a href="#" class="flex items-center px-4 py-2 text-sm hover:bg-gray-100">Mark as Priority</a>
                                </div>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-4">Created glamorous runway looks for NYC Fashion Week with bold colors and textures.</p>
                        <div class="mb-4">
                            <img src="https://images.unsplash.com/photo-1526045478516-99145907023c" alt="Runway Makeup" class="w-full h-64 object-cover rounded-lg shadow-md">
                        </div>
                    </div>

                    <!-- Additional posts can follow the same structure -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize tooltips for navbar icons
        document.addEventListener('DOMContentLoaded', function () {
            tippy('[data-tippy-content]', {
                placement: 'bottom',
                theme: 'light-border',
                animation: 'scale',
                duration: [200, 150]
            });
        });

        // Click ra ben ngoai -> Hien thong bao xac nhan
        function checkClickOutside(event) {
            const modal = document.getElementById('editModal');
            if (modal && event.target === modal) {
                document.getElementById('confirmLeaveModal').classList.remove('hidden');
            }
        }

        function closeConfirmModal() {
            document.getElementById('confirmLeaveModal').classList.add('hidden');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('confirmLeaveModal').classList.add('hidden');
        }

        // Hien thi anh 
        let tempAvatarSrc = "";
        let tempCoverPhotoSrc = "";

        function previewTempImage(event, previewId) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(previewId).src = e.target.result;
                    if (previewId === 'avatarPreview') {
                        tempAvatarSrc = e.target.result;
                    } else if (previewId === 'coverPhotoPreview') {
                        tempCoverPhotoSrc = e.target.result;
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function saveChanges() {
            if (tempAvatarSrc) {
                document.getElementById('profilePictureDisplay').src = tempAvatarSrc;
            }
            if (tempCoverPhotoSrc) {
                document.getElementById('coverPhotoDisplay').src = tempCoverPhotoSrc;
            }
        }

        // call api lay url img:
        // JavaScript: g·ªçi API ƒë·ªÉ l·∫•y URL ·∫£nh ƒë·∫°i di·ªán
        fetch('http://localhost:8080/users/{id}/updateProfilePicture')
            .then(response => response.json())
            .then(data => {
                const avatarPreview = document.getElementById("avatarPreview");
                avatarPreview.src = data.avatarUrl;
            })
            .catch(error => console.error('Error fetching user data:', error));




        // L·∫Øng nghe s·ª± ki·ªán click v√†o n√∫t "L∆∞u"
        document.getElementById('saveButton').addEventListener('click', function() {
            // ·∫®n modal khi nh·∫•n n√∫t L∆∞u
            var myModal = new bootstrap.Modal(document.getElementById('exampleModal'));
            myModal.hide(); // ƒê√≥ng modal
        });




        document.getElementById("saveButton").addEventListener("click", async function() {
            const form = document.getElementById("profileForm");
            const formData = new FormData(form);

            formData.append("user_id", userId);


            try {
                const response = await fetch("/profiles/upload", {
                    method: "POST",
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    console.log("Profile updated successfully", result);
                } else {
                    console.error("Error updating profile", result);
                }
            } catch (error) {
                console.error("Error:", error);
            }
        });

    </script>
</body>
</html>
